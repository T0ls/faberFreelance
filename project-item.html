<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Progetto • Dettagli</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inria+Serif:wght@400;700&display=swap" rel="stylesheet">
    <style>
      /* Minimal, clean page styles matching other pages */
      :root{ --muted:#6b7280; --text:#0b1220; --accent:#0b5fff; --surface: #ffffff; --edge: rgba(2,6,23,0.06); }
      body{ font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color:var(--text); background: #fff; }
      .back-link{ font-size:.9rem; color:var(--muted); text-decoration:none; }
      .back-link:hover{ color:var(--accent); }

      h1#projTitle{ font-size:1.6rem; margin:0.35rem 0 0.6rem; letter-spacing: -0.01em; }

  /* Layout: 4 quadrants using CSS Grid */
  .project-hero{ 
    display: grid; 
    grid-template-columns: 1.5fr 1fr; 
    grid-template-rows: auto auto; 
    gap: 1.5rem; 
    width: 100%;
    min-height: 80vh;
  }
  
  /* Top-left: Video */
  .quadrant-video{ 
    grid-column: 1; 
    grid-row: 1; 
  }
  
  /* Top-right: Info */
  .quadrant-info{ 
    grid-column: 2; 
    grid-row: 1; 
  }
  
  /* Bottom-left: Cast & Crew */
  .quadrant-cast{ 
    grid-column: 1; 
    grid-row: 2; 
  }
  
  /* Bottom-right: Awards */
  .quadrant-awards{ 
    grid-column: 2; 
    grid-row: 2; 
  }
  
  @media (max-width:900px){ 
    .project-hero{ 
      grid-template-columns: 1fr; 
      grid-template-rows: auto auto auto auto;
      gap:1rem; 
      min-height: auto;
    } 
    .quadrant-video{ grid-column: 1; grid-row: 1; }
    .quadrant-info{ grid-column: 1; grid-row: 2; }
    .quadrant-cast{ grid-column: 1; grid-row: 3; }
    .quadrant-awards{ grid-column: 1; grid-row: 4; }
  }

      /* Media stage: clean, edge, and gentle radius */
  /* Media stage: centered, constrained, and visually calm */
  .media-stage{ 
    background:var(--surface); 
    border-radius:8px; 
    padding:0; 
    border:1px solid var(--edge); 
    overflow:hidden; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    height: 100%;
  }
  .media-stage > *{ width:100%; height:auto; display:block; }
  .media-stage img, .media-stage video{ width:100%; height:100%; object-fit:contain; max-height:100%; }
  /* ensure carousel images fill stage while preserving center crop */
  .carousel-img{ width:100%; height:100%; object-fit:cover; }
      .carousel-img{ width:100%; height:100%; object-fit:cover; }

  /* Panel styling for quadrants */
  .panel-container{ 
    background:var(--surface); 
    border-radius:8px; 
    border:1px solid var(--edge); 
    padding: 1.25rem; 
    height: auto;
    overflow-y: auto;
  }
  
  @media (max-width: 900px) {
    .panel-container {
      max-height: none;
      height: auto;
    }
  }
  
  .panel-title{
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--accent);
  }
  
  /* Remove sidebar specific styles */
  aside .card.tabs-card{ border:0; border-radius:0; box-shadow:none; padding:0; background:transparent; }
  aside .card.tabs-card .card-body{ padding:0; }
  aside{ position:relative; }
  @media(min-width:900px){ aside{ position:relative; top:0; align-self:stretch; } }
      .tabs-row{ margin:0; }

  /* Remove tab styles - no longer using tabs */
  .nav-tabs{ display: none; }
  
  /* Carousel for cast and crew */
  .cast-crew-carousel {
    position: relative;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }
  
  .cast-crew-carousel:last-child {
    margin-bottom: 0;
  }
  
  .carousel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
  }
  
  .carousel-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text);
    margin: 0;
  }

  /* Bootstrap-like side controls */
  .carousel-viewport{
    position: relative;
    overflow: hidden;
    width: 100%;
    max-width: 100%;
  }

  .cast-crew-carousel .carousel-control-prev,
  .cast-crew-carousel .carousel-control-next{
    position: absolute;
    top: 0;
    bottom: 0;
    width: 3.25rem;
    border: 0;
    padding: 0;
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.6;
    transition: opacity 0.15s ease;
  }

  .cast-crew-carousel .carousel-control-prev{ left: 0; }
  .cast-crew-carousel .carousel-control-next{ right: 0; }

  .cast-crew-carousel .carousel-control-prev:hover:not(:disabled),
  .cast-crew-carousel .carousel-control-next:hover:not(:disabled){
    opacity: 0.95;
  }

  .cast-crew-carousel .carousel-control-prev:disabled,
  .cast-crew-carousel .carousel-control-next:disabled{
    opacity: 0.15;
    cursor: default;
  }

  /* Give the icons a subtle dark background like Bootstrap */
  .cast-crew-carousel .carousel-control-prev-icon,
  .cast-crew-carousel .carousel-control-next-icon{
    width: 2.25rem;
    height: 2.25rem;
    border-radius: 999px;
    background-color: rgba(0,0,0,0.45);
    background-size: 60% 60%;
  }

  @media (max-width: 768px) {
    .cast-crew-carousel .carousel-control-prev,
    .cast-crew-carousel .carousel-control-next{
      width: 2.75rem;
    }

    .cast-crew-carousel .carousel-control-prev-icon,
    .cast-crew-carousel .carousel-control-next-icon{
      width: 1.75rem;
      height: 1.75rem;
    }
  }
  
  .carousel-track {
    display: flex;
    gap: 1rem;
    transition: transform 0.3s ease;
  }
  
  .carousel-item-card {
    flex: 0 0 200px;
    width: 200px;
    min-width: 180px;
    padding: 0.9rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.6rem;
  }

  @media (max-width: 1200px) {
    .carousel-item-card {
      flex: 0 0 180px;
      width: 180px;
      min-width: 160px;
      padding: 0.8rem;
    }
  }

  @media (max-width: 768px) {
    .carousel-item-card {
      flex: 0 0 150px;
      width: 150px;
      min-width: 140px;
      padding: 0.7rem;
      gap: 0.5rem;
    }
  }

  @media (max-width: 480px) {
    .carousel-item-card {
      flex: 0 0 130px;
      width: 130px;
      min-width: 120px;
      padding: 0.6rem;
      gap: 0.4rem;
    }
  }
  
  .person-thumb{
    width: 125px;
    height: 190px; /* 4:6 portrait ratio */
    border-radius: 12px;
    background: #e5e7eb;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: #1f2937;
    text-transform: uppercase;
    letter-spacing: 0.01em;
    border: 1px solid var(--edge);
    margin-bottom: 0.15rem;
  }

  @media (max-width: 1200px) {
    .person-thumb{
      width: 110px;
      height: 165px;
      border-radius: 10px;
      font-size: 0.9rem;
    }
  }

  @media (max-width: 768px) {
    .person-thumb{
      width: 90px;
      height: 135px;
      border-radius: 8px;
      font-size: 0.8rem;
    }
  }

  @media (max-width: 480px) {
    .person-thumb{
      width: 75px;
      height: 112px;
      border-radius: 6px;
      font-size: 0.7rem;
    }
  }
  
  .person-content{ flex: 1 1 auto; min-width: 0; width: 100%; text-align: center; }
  
  .carousel-item-name {
    font-weight: 600;
    color: var(--text);
    margin-bottom: 0.2rem;
    text-align: center;
    font-size: 0.95rem;
  }

  @media (max-width: 768px) {
    .carousel-item-name {
      font-size: 0.85rem;
      margin-bottom: 0.15rem;
    }
  }

  @media (max-width: 480px) {
    .carousel-item-name {
      font-size: 0.75rem;
      margin-bottom: 0.1rem;
    }
  }
  
  .carousel-item-role {
    font-size: 0.9rem;
    color: var(--muted);
    text-align: center;
    line-height: 1.3;
  }

  @media (max-width: 768px) {
    .carousel-item-role {
      font-size: 0.8rem;
    }
  }

  @media (max-width: 480px) {
    .carousel-item-role {
      font-size: 0.7rem;
    }
  }

/* Accordion: improved visual, clean and minimal - used only for awards subcategories */
  .accordion{ background:transparent; }
  .accordion .accordion-item{ border:0; }
  /* subtle divider between accordion items (categories) */
  .accordion .accordion-item + .accordion-item{ margin-top: 0.5rem; }

  .accordion-button{
    background:rgba(2,6,23,0.02); box-shadow:none; padding:.65rem .75rem; font-weight:600; color:var(--text);
    border-radius:4px; display:flex; align-items:center; justify-content:flex-start; gap:.6rem;
    font-size:.95rem; letter-spacing:0.01em; width:100%; text-align:left; border:1px solid var(--edge); position:relative;
  }
  .accordion-button:hover{ background: rgba(2,6,23,0.04); }
  /* remove default up/down indicator */
  .accordion-button::after{ display:none !important; }

  /* accent strip on the left when expanded */
  .accordion-button:not(.collapsed){ color:var(--accent); background: rgba(11,95,255,0.05); }
  .accordion-button::before{ display:none; }
  .accordion-button:not(.collapsed)::before{ content:''; position:absolute; left:0; top:8px; bottom:8px; width:3px; background:var(--accent); border-radius: 0 2px 2px 0; }

  .accordion .accordion-header + .accordion-collapse{ border-top:0; }
  /* Body: readable, generous leading */
  .accordion-body{ padding:.75rem .75rem; color:var(--text); font-size:.95rem; line-height:1.55; }
  .accordion-body ul { margin: 0; padding-left: 1.25rem; }
  .accordion-body li { margin-bottom: 0.35rem; }

  /* Fade micro-animation for tab panels */
  .tab-pane.fade{ opacity:0; transition: opacity .28s ease; }
  .tab-pane.fade.show{ opacity:1; }

      .no-data{ color:var(--muted); font-style:italic; font-size: 0.95rem; }
  /* Meta items: compact but readable. Labels align to the left on wide screens, stack on small screens. */
  .meta-item{ display:flex; gap:.5rem; color:var(--text); font-size:.95rem; align-items:flex-start; margin-bottom: 0.75rem; }
  .meta-item strong{ min-width:5rem; color:var(--text); font-weight:700; font-size:.95rem; letter-spacing:0.01em; }
  .meta-item span{ color: var(--muted); }
  @media(max-width:520px){ .meta-item{ flex-direction:column; gap:.25rem; } .meta-item strong{ width:auto; } }
  /* Section headings (Awards, Cast, Crew) should match Year label styling for clarity */
  .section-heading{ display:block; color:var(--text); font-weight:700; font-size:.95rem; margin:0 0 .35rem; letter-spacing:0.01em; }

      /* optional panel
         small note area under tabs for downloads or related links */
      #optionalPanel{ font-size:.95rem; color:var(--muted); }

      @font-face{
        font-family: "Obra Letra";
        src: local("Obra Letra")
             /* , url("/fonts/ObraLetra.woff2") format("woff2"),
                url("/fonts/ObraLetra.woff") format("woff") */;
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }

      /* Navbar con sfondo pieno per evitare trasparenza */
      .navbar { background-color: #fff; }

      /* LOGO */
      .logo-mark{
        display:inline-flex;
        align-items:flex-end;
        gap:.3rem;
        margin-left:25px;
        /* scala globale del logo: aumenta/diminuisci qui */
        --logo-size: 38px;
        font-size: var(--logo-size);
        color:#000;
      }
      .logo-F{
        font-family: "Inria Serif", serif;
        font-weight: 700;
        /* F alta ~ due righe */
        font-size: 2.5em;
        line-height: .85;
        margin-right:.05rem;
      }
      .logo-stack{
        display:flex;
        flex-direction:column;
        line-height:1;
		margin-left: -5px;
      }
      .logo-line{
        font-family: "Inria Serif", serif;
        font-size:1em;
        line-height:1;
        letter-spacing: .005em; /* micro aggiustamento */
      }
	  .nav-link{
		  font-size: 20px;
	  }

    /* Page entry fade from bottom */
    body.page-animate {
    opacity: 0;
    transform: translateY(22px);
    transition: none;
    }

    body.page-animate.page-animate--visible {
    animation: fadeInUp 720ms ease-out forwards;
    }

    @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(22px); }
    to { opacity: 1; transform: translateY(0); }
    }

    @media (prefers-reduced-motion: reduce) {
    body.page-animate { opacity: 1; transform: none; }
    body.page-animate.page-animate--visible { animation: none; }
    }
    </style>
  </head>
  <body class="page-animate">
		<!-- Navbar -->
		<nav class="navbar navbar-expand-md sticky-top shadow-sm bg-body">
			<div class="container">
				<a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
					<span class="logo-mark logo-theme-iceNavy">
						<span class="logo-color logo-F">F</span>
						<span class="logo-stack">
							<span class="logo-color logo-line">aber</span>
							<span class="logo-color logo-line">reelance</span>
						</span>
					</span>
				</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="mainNav">
					<ul class="navbar-nav ms-auto">
						<li class="nav-item hvr-grow"><a class="nav-link" href="about.html">About</a></li>
						<li class="nav-item hvr-grow"><a class="nav-link" href="showreel.html">Showreel</a></li>
						<li class="nav-item hvr-grow"><a class="nav-link" href="lavori.html">Lavori</a></li>
						<li class="nav-item hvr-grow"><a class="nav-link" href="contatti.html">Contatti</a></li>
					</ul>
				</div>
			</div>
		</nav>

    <main class="container py-5">
      <div id="notFound" style="display:none" class="alert alert-warning">Progetto non trovato. Controlla lo slug nell'URL.</div>

      <div id="projectRoot" style="display:none">
        <a class="back-link" href="lavori.html">← Torna a Lavori</a>
        <h1 id="projTitle" class="mt-3"></h1>
        <div class="project-hero mt-3">
          <!-- Top-left: Video -->
          <div class="quadrant-video">
            <div id="mediaArea" class="media-stage"></div>
          </div>
          
          <!-- Top-right: Info -->
          <div class="quadrant-info">
            <div class="panel-container">
              <h2 class="panel-title">Informazioni</h2>
              <div id="infoPanel"></div>
            </div>
          </div>
          
          <!-- Bottom-left: Cast & Crew -->
          <div class="quadrant-cast">
            <div class="panel-container">
              <h2 class="panel-title">Cast & Crew</h2>
              <div id="castCrewPanel"></div>
            </div>
          </div>
          
          <!-- Bottom-right: Awards -->
          <div class="quadrant-awards">
            <div class="panel-container">
              <h2 class="panel-title">Premi e Riconoscimenti</h2>
              <div id="awardsPanel"></div>
            </div>
          </div>
        </div>
      </div>
    </main>

		<!-- Footer -->
		<footer class="py-4 mt-5">
			<div class="container d-flex flex-column flex-sm-row align-items-center justify-content-between gap-3">
				<div class="small">
					© <span id="year"></span> Fabrizio Arrigo • Tutti i diritti riservati
				</div>
				<div class="d-flex gap-3 small">
					<a href="https://www.linkedin.com/in/fabrizio-faber-arrigo-a1b77a22b" target="_blank" class="text-decoration-none"><i class="bi bi-linkedin"></i></a>
					<a href="https://www.instagram.com/faber.arrigo" target="_blank" class="text-decoration-none"><i class="bi bi-instagram"></i></a>
				</div>
			</div>
		</footer>

  <!-- Image modal: used to show enlarged photos. Clicking the backdrop closes the modal. -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-transparent border-0">
        <div class="modal-body p-0" style="background:transparent;">
          <img id="imageModalImg" src="" alt="" style="width:100%; height:auto; display:block; border-radius:6px;" />
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- load projects data so window.PROJECTS and window.PROJECTS_BY_SLUG are available -->
  <script src="data/projects-data.js"></script>
  <script>
		// set footer year & trigger page animation
		document.getElementById('year').textContent = new Date().getFullYear();
		document.addEventListener('DOMContentLoaded', () => {
			document.body.classList.add('page-animate--visible');
		});

    // Helper: get slug from ?slug= or from filename (progetto-pilipu.html -> progetto-pilipu)
    function getSlug(){
      const params = new URLSearchParams(location.search);
      if(params.get('slug')) return params.get('slug');
      const last = location.pathname.split('/').pop() || '';
      return last.replace(/\.html?$/i,'') || null;
    }

    function createMetaItem(label, value){
      const div = document.createElement('div');
      div.className='meta-item';
      div.innerHTML = `<strong>${label}</strong><span>${value||''}</span>`;
      return div;
    }

    function renderMedia(project, container){
      container.innerHTML='';

      const normalizeMediaList = (value)=>{
        if(!value) return [];
        const arr = Array.isArray(value) ? value : [value];
        return arr
          .map(item => {
            if(typeof item === 'string') return { src: item };
            if(item && item.src) return item;
            return null;
          })
          .filter(Boolean);
      };

      const isVideoSrc = (src)=> /\.(mp4|webm|ogg|mov)(\?|$)/i.test(src);

      // Build thumb media list (can mix images and videos)
      const thumbList = normalizeMediaList(project.thumb);

      // priority: video if present, otherwise images (carousel if multiple), otherwise thumb list
      if(project.video && project.video.length){
        const v = document.createElement('video');
        v.controls = true; v.playsInline = true; v.muted = false; v.style.width='100%';
        project.video.forEach(src => {
          const s = document.createElement('source'); s.src = src; v.appendChild(s);
        });
        container.appendChild(v);
        return;
      }
      const imgs = project.images || (project.gallery || []);
      if(imgs && imgs.length>1){
        const id = 'projCarousel';
        const wrap = document.createElement('div');
        wrap.id = id; wrap.className='carousel slide'; wrap.setAttribute('data-bs-ride','carousel');
        const inner = document.createElement('div'); inner.className='carousel-inner';
        imgs.forEach((u,i)=>{
          const it = document.createElement('div'); it.className = 'carousel-item' + (i===0? ' active':'');
          const img = document.createElement('img'); img.src = u; img.className='d-block w-100 carousel-img'; img.alt = project.title + ' image ' + (i+1);
          it.appendChild(img); inner.appendChild(it);
        });
        wrap.appendChild(inner);
        wrap.innerHTML += `\n<button class="carousel-control-prev" type="button" data-bs-target="#${id}" data-bs-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="visually-hidden">Previous</span></button>\n<button class="carousel-control-next" type="button" data-bs-target="#${id}" data-bs-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="visually-hidden">Next</span></button>`;
        container.appendChild(wrap);
        try{
          const carousel = bootstrap.Carousel.getOrCreateInstance(wrap, { interval: 3000, wrap: true });
          carousel.cycle();
        }catch(e){ /* ignore */ }
        inner.querySelectorAll('img').forEach(img => { img.style.cursor = 'zoom-in'; img.addEventListener('click', (ev)=>{ ev.stopPropagation(); openImageModal(img.src); }); });
        wrap.style.cursor = 'zoom-in';
        wrap.addEventListener('click', (ev)=>{
          if(ev.target.closest('.carousel-control-prev') || ev.target.closest('.carousel-control-next')) return;
          const activeImg = wrap.querySelector('.carousel-item.active img') || wrap.querySelector('img');
          if(activeImg) openImageModal(activeImg.src);
        });
        return;
      }
      if(imgs && imgs.length===1){
        const img = document.createElement('img'); img.src = imgs[0]; img.alt = project.title; img.style.width='100%'; img.style.borderRadius='6px';
        img.style.cursor = 'zoom-in';
        img.addEventListener('click', ()=> openImageModal(img.src));
        container.appendChild(img); return;
      }

      // thumb list fallback (can mix images and videos)
      if(thumbList.length>1){
        const id = 'thumbCarousel-' + (project.slug || project.id || Math.random().toString(36).slice(2,6));
        const wrap = document.createElement('div');
        wrap.id = id; wrap.className='carousel slide';
        wrap.setAttribute('data-bs-ride','carousel');
        wrap.setAttribute('data-bs-interval','3500');
        const inner = document.createElement('div'); inner.className='carousel-inner';

        thumbList.forEach((item,i)=>{
          const it = document.createElement('div'); it.className = 'carousel-item' + (i===0? ' active':'');
          const isVideo = item.type === 'video' || isVideoSrc(item.src);
          if(isVideo){
            const v = document.createElement('video');
            v.controls = true; v.playsInline = true; v.muted = true; v.loop = true; v.style.width='100%'; v.style.height='100%'; v.style.objectFit='contain';
            const s = document.createElement('source'); s.src = item.src; v.appendChild(s);
            it.appendChild(v);
          } else {
            const img = document.createElement('img'); img.src = item.src; img.className='d-block w-100 carousel-img'; img.alt = project.title + ' thumb ' + (i+1);
            img.style.cursor = 'zoom-in';
            img.addEventListener('click', (ev)=>{ ev.stopPropagation(); openImageModal(img.src); });
            it.appendChild(img);
          }
          inner.appendChild(it);
        });

        wrap.appendChild(inner);
        wrap.innerHTML += `\n<button class="carousel-control-prev" type="button" data-bs-target="#${id}" data-bs-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="visually-hidden">Previous</span></button>\n<button class="carousel-control-next" type="button" data-bs-target="#${id}" data-bs-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="visually-hidden">Next</span></button>`;
        container.appendChild(wrap);
        try{
          const carousel = bootstrap.Carousel.getOrCreateInstance(wrap, { interval: 3500, wrap: true });
          carousel.cycle();
        }catch(e){ /* ignore */ }
        return;
      }

      if(thumbList.length===1){
        const item = thumbList[0];
        const isVideo = item.type === 'video' || isVideoSrc(item.src);
        if(isVideo){
          const v = document.createElement('video');
          v.controls = true; v.playsInline = true; v.muted = false; v.style.width='100%';
          const s = document.createElement('source'); s.src = item.src; v.appendChild(s);
          container.appendChild(v); return;
        }
        const img = document.createElement('img'); img.src = item.src; img.alt = project.title; img.style.width='100%'; img.style.borderRadius='6px'; img.style.cursor='zoom-in'; img.addEventListener('click', ()=> openImageModal(img.src)); container.appendChild(img); return;
      }

      container.innerHTML = '<div class="no-data">Nessun media disponibile</div>';
    }

    // Sync right-side panel heights to match the corresponding left-side panels (desktop only)
    function syncPanelHeights(){
      const isStacked = window.innerWidth < 900; // matches CSS breakpoint for single column
      const infoPanel = document.querySelector('.quadrant-info .panel-container');
      const awardsPanel = document.querySelector('.quadrant-awards .panel-container');
      const mediaStage = document.querySelector('.quadrant-video .media-stage');
      const castPanel = document.querySelector('.quadrant-cast .panel-container');

      // On stacked layout, let panels size naturally
      if(isStacked){
        if(infoPanel){ infoPanel.style.maxHeight = ''; }
        if(awardsPanel){ awardsPanel.style.maxHeight = ''; }
        return;
      }

      if(infoPanel && mediaStage){
        const h = mediaStage.getBoundingClientRect().height;
        infoPanel.style.maxHeight = h ? `${h}px` : '';
      }

      if(awardsPanel && castPanel){
        const h = castPanel.getBoundingClientRect().height;
        awardsPanel.style.maxHeight = h ? `${h}px` : '';
      }
    }

    function renderTabs(project, container){
      // This function is no longer used but kept for compatibility
      container.innerHTML = '';
    }

    // Render info panel
    function renderInfoPanel(project, container){
      container.innerHTML = '';
      
      // Check if there's any info to display
      const hasInfo = project.description || project.year || project.role || project.client || project.duration || (project.tags && project.tags.length);
      
      if(!hasInfo){
        return false;
      }
      
      // Description
      if(project.description){
        const desc = document.createElement('div');
        desc.innerHTML = project.description;
        desc.style.marginBottom = '1.25rem';
        desc.style.lineHeight = '1.6';
        desc.style.color = 'var(--muted)';
        container.appendChild(desc);
      }
      
      // Details
      if(project.year) container.appendChild(createMetaItem('Anno', project.year));
      if(project.role) container.appendChild(createMetaItem('Ruolo', project.role));
      if(project.client) container.appendChild(createMetaItem('Cliente', project.client));
      if(project.duration) container.appendChild(createMetaItem('Durata', project.duration));
      if(project.tags && project.tags.length) container.appendChild(createMetaItem('Tag', project.tags.join(', ')));
      
      return true;
    }

    // Render awards panel
    function renderAwardsPanel(project, container){
      container.innerHTML = '';
      
      if(!project.awards || (!project.awards.wins?.length && !project.awards.nominations?.length)){
        return false;
      }
      
      const accordion = document.createElement('div');
      accordion.className = 'accordion';
      accordion.id = 'awardsAccordion';
      
      let itemIndex = 0;
      
      // Wins
      if(project.awards.wins && project.awards.wins.length){
        const item = document.createElement('div');
        item.className = 'accordion-item';
        
        const headerId = 'headingWins';
        const collapseId = 'collapseWins';
        
        const header = document.createElement('h2');
        header.className = 'accordion-header';
        header.id = headerId;
        
        const button = document.createElement('button');
        button.className = 'accordion-button';
        button.type = 'button';
        button.setAttribute('data-bs-toggle', 'collapse');
        button.setAttribute('data-bs-target', '#' + collapseId);
        button.setAttribute('aria-expanded', 'true');
        button.setAttribute('aria-controls', collapseId);
        button.innerHTML = '<i class="bi bi-trophy-fill me-2"></i>Vinti (' + project.awards.wins.length + ')';
        
        header.appendChild(button);
        
        const collapse = document.createElement('div');
        collapse.id = collapseId;
        collapse.className = 'accordion-collapse collapse show';
        collapse.setAttribute('aria-labelledby', headerId);
        collapse.setAttribute('data-bs-parent', '#awardsAccordion');
        
        const body = document.createElement('div');
        body.className = 'accordion-body';
        
        const ul = document.createElement('ul');
        ul.style.paddingLeft = '1.25rem';
        ul.style.margin = '0';
        project.awards.wins.forEach(w => {
          const li = document.createElement('li');
          li.textContent = w;
          li.style.marginBottom = '0.5rem';
          ul.appendChild(li);
        });
        body.appendChild(ul);
        collapse.appendChild(body);
        
        item.appendChild(header);
        item.appendChild(collapse);
        accordion.appendChild(item);
        itemIndex++;
      }
      
      // Nominations
      if(project.awards.nominations && project.awards.nominations.length){
        const item = document.createElement('div');
        item.className = 'accordion-item';
        
        const headerId = 'headingNominations';
        const collapseId = 'collapseNominations';
        
        const header = document.createElement('h2');
        header.className = 'accordion-header';
        header.id = headerId;
        
        const button = document.createElement('button');
        button.className = 'accordion-button' + (itemIndex === 0 ? '' : ' collapsed');
        button.type = 'button';
        button.setAttribute('data-bs-toggle', 'collapse');
        button.setAttribute('data-bs-target', '#' + collapseId);
        button.setAttribute('aria-expanded', itemIndex === 0 ? 'true' : 'false');
        button.setAttribute('aria-controls', collapseId);
        button.innerHTML = '<i class="bi bi-award me-2"></i>Nomination (' + project.awards.nominations.length + ')';
        
        header.appendChild(button);
        
        const collapse = document.createElement('div');
        collapse.id = collapseId;
        collapse.className = 'accordion-collapse collapse' + (itemIndex === 0 ? ' show' : '');
        collapse.setAttribute('aria-labelledby', headerId);
        collapse.setAttribute('data-bs-parent', '#awardsAccordion');
        
        const body = document.createElement('div');
        body.className = 'accordion-body';
        
        const ul = document.createElement('ul');
        ul.style.paddingLeft = '1.25rem';
        ul.style.margin = '0';
        project.awards.nominations.forEach(n => {
          const li = document.createElement('li');
          li.textContent = n;
          li.style.marginBottom = '0.5rem';
          ul.appendChild(li);
        });
        body.appendChild(ul);
        collapse.appendChild(body);
        
        item.appendChild(header);
        item.appendChild(collapse);
        accordion.appendChild(item);
      }
      
      container.appendChild(accordion);
      return true;
    }

    // Render cast and crew panel with carousels
    function renderCastCrewPanel(project, container){
      container.innerHTML = '';
      
      if((!project.cast || !project.cast.length) && (!project.crew || !project.crew.length)){
        return false;
      }
      
      // Cast carousel
      if(project.cast && project.cast.length){
        const castCarousel = createCarousel('cast', 'Cast', project.cast);
        container.appendChild(castCarousel);
      }
      
      // Crew carousel
      if(project.crew && project.crew.length){
        const crewCarousel = createCarousel('crew', 'Crew', project.crew);
        container.appendChild(crewCarousel);
      }
      
      return true;
    }

    // Create a carousel for cast or crew
    function createCarousel(id, title, items){
      const wrapper = document.createElement('div');
      wrapper.className = 'cast-crew-carousel';
      wrapper.setAttribute('data-carousel-id', id);
      
      // Header with title and controls
      const header = document.createElement('div');
      header.className = 'carousel-header';
      
      const titleEl = document.createElement('h3');
      titleEl.className = 'carousel-title';
      titleEl.textContent = title;
      header.appendChild(titleEl);
      
      wrapper.appendChild(header);
      
      // Track container
      const trackContainer = document.createElement('div');
      trackContainer.className = 'carousel-viewport';
      
      const track = document.createElement('div');
      track.className = 'carousel-track';
      track.setAttribute('data-carousel-track', id);
      
      // Add items
      items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'carousel-item-card';
        
        const thumb = document.createElement('div');
        thumb.className = 'person-thumb';
        const nameVal = typeof item === 'string' ? item : (item.name || '');
        const photo = (typeof item === 'object' && item.photo) ? item.photo : null;
        if(photo){
          thumb.style.backgroundImage = `url(${photo})`;
          thumb.textContent = '';
        } else {
          const initials = (nameVal || '').trim().split(/\s+/).map(p=>p[0]||'').join('').slice(0,2).toUpperCase() || '?';
          thumb.textContent = initials;
        }
        card.appendChild(thumb);

        const content = document.createElement('div');
        content.className = 'person-content';

        const name = document.createElement('div');
        name.className = 'carousel-item-name';
        name.textContent = nameVal;
        content.appendChild(name);
        
        if(typeof item === 'object' && item.role){
          const role = document.createElement('div');
          role.className = 'carousel-item-role';
          role.textContent = item.role;
          content.appendChild(role);
        }

        card.appendChild(content);
        
        track.appendChild(card);
      });
      
      trackContainer.appendChild(track);

      // Bootstrap-like side controls
      const prevBtn = document.createElement('button');
      prevBtn.type = 'button';
      prevBtn.className = 'carousel-control-prev';
      prevBtn.setAttribute('data-carousel-action', 'prev');
      prevBtn.setAttribute('aria-label', 'Previous');
      prevBtn.innerHTML = '<span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="visually-hidden">Previous</span>';

      const nextBtn = document.createElement('button');
      nextBtn.type = 'button';
      nextBtn.className = 'carousel-control-next';
      nextBtn.setAttribute('data-carousel-action', 'next');
      nextBtn.setAttribute('aria-label', 'Next');
      nextBtn.innerHTML = '<span class="carousel-control-next-icon" aria-hidden="true"></span><span class="visually-hidden">Next</span>';

      trackContainer.appendChild(prevBtn);
      trackContainer.appendChild(nextBtn);

      wrapper.appendChild(trackContainer);
      
      // Initialize carousel state
      setTimeout(() => initCarousel(id), 0);
      
      return wrapper;
    }

    // Initialize carousel functionality
    function initCarousel(id){
      const carousel = document.querySelector(`[data-carousel-id="${id}"]`);
      if(!carousel) return;
      
      const track = carousel.querySelector(`[data-carousel-track="${id}"]`);
      const prevBtn = carousel.querySelector('[data-carousel-action="prev"]');
      const nextBtn = carousel.querySelector('[data-carousel-action="next"]');
      
      if(!track || !prevBtn || !nextBtn) return;
      
      const items = track.querySelectorAll('.carousel-item-card');
      if(items.length === 0) return;
      
      let currentIndex = 0;
      
      // Calculate items per page based on available width
      function getItemsPerPage(){
        // breakpoint-based sizing by screen width: mobile 1, medium 2, large 4
        // aligned with Bootstrap-ish breakpoints: md=768, lg=992
        const w = window.innerWidth || document.documentElement.clientWidth || 0;
        if(w >= 992) return 4;
        if(w >= 768) return 2;
        return 1;
      }
      
      function updateCarousel(){
        const itemsPerPage = getItemsPerPage();
        const maxIndex = Math.max(0, items.length - itemsPerPage);
        
        // Clamp current index
        currentIndex = Math.max(0, Math.min(currentIndex, maxIndex));
        
        // Calculate offset
        const rect = items[0].getBoundingClientRect();
        const itemWidth = rect.width || items[0].offsetWidth || 240;
        const gap = parseFloat(window.getComputedStyle(track).gap || '16') || 16;

        // Constrain viewport so we always show exactly itemsPerPage cards per "page"
        // even if the container is wide enough to display more.
        const viewport = track.parentElement;
        const viewportWidth = (itemsPerPage * itemWidth) + (Math.max(0, itemsPerPage - 1) * gap);
        viewport.style.maxWidth = viewportWidth + 'px';
        viewport.style.marginLeft = 'auto';
        viewport.style.marginRight = 'auto';

        const offset = currentIndex * (itemWidth + gap);
        
        track.style.transform = `translateX(-${offset}px)`;
        
        // Update button states
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex >= maxIndex;
      }
      
      prevBtn.addEventListener('click', () => {
        const itemsPerPage = getItemsPerPage();
        currentIndex = Math.max(0, currentIndex - itemsPerPage);
        updateCarousel();
      });
      
      nextBtn.addEventListener('click', () => {
        const itemsPerPage = getItemsPerPage();
        const maxIndex = Math.max(0, items.length - itemsPerPage);
        currentIndex = Math.min(maxIndex, currentIndex + itemsPerPage);
        updateCarousel();
      });
      
      // Update on window resize
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(updateCarousel, 100);
      });

      // React to container size changes (e.g., quadrant hide/show)
      if(window.ResizeObserver){
        const ro = new ResizeObserver(() => updateCarousel());
        ro.observe(track.parentElement);
      }
      
      // Initial update
      updateCarousel();
    }

    // Open the image modal with the provided src
    function openImageModal(src){
      const modalEl = document.getElementById('imageModal');
      const img = document.getElementById('imageModalImg');
      if(!modalEl || !img) return;
      img.src = src || '';
      try{
        const modal = bootstrap.Modal.getOrCreateInstance(modalEl, { backdrop: true });
        modal.show();
      }catch(e){ /* ignore if bootstrap missing */ }
    }

    // clear modal image on hide to free memory
    (function(){
      const modalEl = document.getElementById('imageModal');
      if(modalEl){
        modalEl.addEventListener('hidden.bs.modal', ()=>{ const img = document.getElementById('imageModalImg'); if(img) img.src=''; });
      }
    })();

    window.addEventListener('load', ()=>{
      const slug = getSlug();
      const notFound = document.getElementById('notFound');
      const root = document.getElementById('projectRoot');
      if(!slug){ notFound.style.display='block'; return; }

      // find project from globals: require exact slug or id match only
      let project = null;
      if(window.PROJECTS_BY_SLUG && window.PROJECTS_BY_SLUG[slug]){
        project = window.PROJECTS_BY_SLUG[slug];
      } else if(window.PROJECTS && Array.isArray(window.PROJECTS)){
        // exact match on slug or id (string)
        project = window.PROJECTS.find(p => (p && (p.slug === slug || String(p.id) === String(slug))));
      }

      if(!project){
        // Render a simple not-found page like showreel-item.html
        document.querySelector('main').innerHTML = '<div class="container text-center py-5"><p class="lead">Progetto non trovato.</p><p><a class="text-muted" href="lavori.html">← Torna a Lavori</a></p></div>';
        return;
      }

      document.getElementById('projTitle').textContent = project.title || 'Progetto';
      
      // Render media in top-left quadrant
      const mediaArea = document.getElementById('mediaArea');
      renderMedia(project, mediaArea);
      
      // Render info in top-right quadrant
      const infoPanel = document.getElementById('infoPanel');
      const infoQuadrant = document.querySelector('.quadrant-info');
      const hasInfo = renderInfoPanel(project, infoPanel);
      if(!hasInfo && infoQuadrant) infoQuadrant.style.display = 'none';
      
      // Render cast & crew in bottom-left quadrant
      const castCrewPanel = document.getElementById('castCrewPanel');
      const castQuadrant = document.querySelector('.quadrant-cast');
      const hasCastCrew = renderCastCrewPanel(project, castCrewPanel);
      if(!hasCastCrew && castQuadrant) castQuadrant.style.display = 'none';
      
      // Render awards in bottom-right quadrant
      const awardsPanel = document.getElementById('awardsPanel');
      const awardsQuadrant = document.querySelector('.quadrant-awards');
      const hasAwards = renderAwardsPanel(project, awardsPanel);
      if(!hasAwards && awardsQuadrant) awardsQuadrant.style.display = 'none';

      root.style.display = '';

      // sync heights after initial render
      requestAnimationFrame(syncPanelHeights);
      setTimeout(syncPanelHeights, 300);
    });

    // Re-sync on resize (debounced)
    (function(){
      let t = null;
      window.addEventListener('resize', ()=>{
        if(t) clearTimeout(t);
        t = setTimeout(syncPanelHeights, 120);
      });
    })();
    </script>
  </body>
</html>
